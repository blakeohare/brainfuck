const BrainFuck=()=>{let e=(...e)=>console.log(...e),t=[],r=[];for(let e=0;e<3e4;e++)r.push(0);let a={setCode:e=>{let r=new Set("-+<>[]*".split("")),n=e.split("").filter((e=>r.has(e))).join("");return t=(e=>{let t=e.split(""),r=[];for(let e of t)switch(e){case"<":case">":case"+":case"-":r.length&&r[r.length-1].type===e?r[r.length-1].amount++:r.push({type:e,amount:1});break;default:r.push({type:e,target:null,hasNestedJump:!1})}for(let e=0;e<r.length;e++)if("["===r[e].type&&e+4<r.length){let t=r.slice(e+1,e+6).map((e=>e.type)).join(""),a=!1;if(1===r[e+1].amount&&("->+<]"===t?(r[e]={type:"ADD-MOVE",dest:r[e+2].amount,jump:5,factor:r[e+3].amount},a=!0):"-<+>]"===t&&(r[e]={type:"ADD-MOVE",dest:-r[e+2].amount,jump:5,factor:r[e+3].amount},a=!0)),a)for(let t=0;t<5;t++)r[e+1+t]={type:"NOOP"}}let a=[];for(let e=0;e<r.length;e++)if("["===r[e].type)a.push(e);else if("]"===r[e].type){if(!a.length)throw new Error;{let t=a.pop();r[t].target=e,r[e].target=t}}if(a.length)throw new Error;return r})(n),a},setString:(e,t)=>{let n=t;for(let t=0;t<e.length;t++)r[n++]=e.charCodeAt(t);return r[n]=0,a},setInt8:(e,t)=>(r[t]=255&e,a),setInt32:(e,t)=>(r[t+3]=255&e,e>>=8,r[t+2]=255&e,e>>=8,r[t+1]=255&e,e>>=8,r[t]=255&e,a),run:()=>{let n=0,l=0,o=t.length;for(;n<o;){let a=t[n];switch(a.type){case"NOOP":break;case"+":r[l]=r[l]+a.amount&255;break;case"-":r[l]=r[l]-a.amount&255;break;case"<":l-=a.amount;break;case">":l+=a.amount;break;case"[":r[l]||(n=a.target);break;case"]":r[l]&&(n=a.target-1);break;case"ADD-MOVE":r[l+a.dest]=r[l+a.dest]+r[l]*a.factor&255,r[l]=0,n+=a.jump;break;case"*":e(`PC: ${n}, MC: ${l}`,r.slice(0,20),r)}n++}return a},setLogger:t=>{e=t},getString:e=>{let t=[];for(let a=e;0!==r[a];a++)t.push(String.fromCharCode(r[a]));return t.join("")},getInt8:e=>255&r[e],getInt32:e=>r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]};return Object.freeze(a)};
